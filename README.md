# MODpy
Python MOD analyser. 

Process rough workflow: 
Parse reads MOD_file, removes 'bad' events due to lumi blocks, trigger effects, JQC, Fastjet comparison, then creates a .dat file of the hardest jet objects. The events are filtered and processed as the followings. 

A lumiblock is a smallest unit of time for storing information produced by the collider (and does not necessarily coincide with the time of a circulation of the two beams). A lumiblock is labeled either "good" or "bad" by CERN, and only information produced in a "good" lumiblock shall be used. A list of good lumiblocks, labeled by their run #s and ls #s (or "LumiBlock" as shown in .mod files from MODProducer), are stored in ```2011lumibyls.csv``` (for 2011 opendata, which can be downloaded at http://opendata.cern.ch/record/1051). Multiple events are stored in a lumiblock. 

```parse.py``` loads the labels of all the "good" lumiblocks as appearing in  ```2011lumibyls.csv```. Then it calls ```analyze_MOD``` in ```analyze_MOD.py``` to process the MOD files in the input directory file by file. 

The events in the MOD file is selected by the followings, assuming a ```BeginEvent``` tag and an ```EndEvent``` tag encapsulate every event. 

If the event is not in a "good" lumiblock, it is ommited. 

If the event lacks any of the ```Trig```, ```AK5```, or ```PFC``` section, it is ommited (it is assumed that a legend line exist before each section). 

If the highest AK5 pT is in a trigger range with the corresponding trigger unfired, the event is ommited. 

The loose JQC (Jet Quality Criteria) is checked against the event and the event is rejected if it failed the pass. Otherwise the event is assigned with a jet quality of 1, 2, or 3, for loose, medium or strong. 

The PFCs (Particle Flow Candidate) are then read into fastjet program and various jet information of the event is produced. The fastjet-produced jets are then compared with the hardest AK5 jets, and the event is rejected if the two fail to match. 

Plot_dat then generates plots from this 

Todo: 
1. Write the functionality to write ```effective_luminosity_by_trigger.csv``` file. 
2. Find out the JQCs. 

************************************************************************************************************************************************
This repository has code to analyze MOD (MIT Open Data) files produced using [MODProducer]
(https://github.com/rmastand/MODProducer "MODProducer" for latest version).
It is an adaption of MODAnalyzer for implementation with python.
(https://github.com/prekshan/MODAnalyzer/tree/master).

Ensure that fastjet is installed and compiled.
(http://www.fastjet.fr)

###############################################################################

Process rough workflow:
Parse reads MOD_file(s) in the input folder.
It calls the analyzeMOD function which removes 'bad' events due to: lumi blocks, trigger effects, Jet Quality Criteria, Fastjet comparison.
It then creates a .dat file of the two hardest jet objects.
Plot_dat then generates plots from this.

This code runs using python3.
...command to run the code from the MODpy folder is:
python3 parse.py ~/path/to/folder/containing/MOD_files ~/output/folder/for/dat_files [optional] Number_of_events_limiter [optional]
e.g. "python3 ~/Documents/MOD_files ~/Documents/MODpy_output 10000"

######Comments about the plotting mechanism - for Joe to fill in#######

Cross-checking scripts are provided:
Print_MOD_file will print selected events from an argument input MOD file to allow manual comparison.
Dat_file_length_check will compare the number of events in two argument input dat files, and print the first event difference where one exists.

############################################################################### The EnergyFlow branch

The EnergyFlow framework was used for central / forwards jet tagging on jet data generated by MODpy. In this branch, .consts files are now produced by the analyze_MOD function call. These are included for convenient input into the EnergyFlow interface. Four additional files are included in the energyflow directory. These are:

efp_example.py: a copy of the EFP EnergyFlow example, included for quick reference
efp_fc_training.py: a version of the above example adapted to use MODpy data to run the machine learning analysis on forwards/central jet labels
fc_inputs.py: loads data from .consts files in a useful format for analysis of forwards and central jets
auc_curve.py: a short file for plotting curves of AUC values
###############################################################################
TO DO:
Modify dat file structure to contain all events (including bad, with reason why rejected)
Implement: CHS, pileup
Introduce: Sim/GEN data, Machine-learning methods
